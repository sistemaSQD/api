'use strict';const a47_0x191349=a47_0x1143;(function(_0x1bbdb2,_0x4d8321){const _0x5c0d5f=a47_0x1143,_0x1d86e9=_0x1bbdb2();while(!![]){try{const _0x28e43f=parseInt(_0x5c0d5f(0xd7))/0x1*(parseInt(_0x5c0d5f(0xcc))/0x2)+-parseInt(_0x5c0d5f(0xc7))/0x3+-parseInt(_0x5c0d5f(0xc8))/0x4+parseInt(_0x5c0d5f(0x107))/0x5*(parseInt(_0x5c0d5f(0xd5))/0x6)+-parseInt(_0x5c0d5f(0x10d))/0x7+parseInt(_0x5c0d5f(0xf9))/0x8+parseInt(_0x5c0d5f(0x108))/0x9;if(_0x28e43f===_0x4d8321)break;else _0x1d86e9['push'](_0x1d86e9['shift']());}catch(_0x1807cf){_0x1d86e9['push'](_0x1d86e9['shift']());}}}(a47_0x1587,0x9f495));function a47_0x1587(){const _0x4fbad1=['createClient','message','Server','map','body','error','Lo\x20sentimos\x20no\x20se\x20pudo\x20registrar\x20el\x20servidor\x20LDAP','register','auth\x20ldap\x20server','../models/ServerLdap','json','ServerLdap','ServerLdapInterface','searchEntry','linkProxyServer','delete','Lo\x20sentimos\x20el\x20Dn\x20Base\x20es\x20incorrecto','host','host_not_is_ip','withMessage','save','Lo\x20sentimos\x20este\x20servidor\x20LDAP\x20no\x20se\x20encuentra\x20registrado','express-validator','isEmpty','findOne','923967lFWyJS','3728160mPAhCD','search\x20source','Lo\x20sentimos\x20no\x20se\x20pudo\x20encontrar\x20la\x20entidad\x20especificada','savedserver','2192278fjEkkK','validationResult','host_empty','getLdapServers','findserver','Lo\x20sentimos\x20no\x20se\x20pudo\x20encontrar\x20ninguna\x20entidad\x20en\x20el\x20servidor\x20LDAP','reject','encryption','apply','18pdOrvw','../models/Server','1bnofhZ','Servidor\x20LDAP\x20eliminado\x20correctamente','findById','deleteServer','update','length','serverldap','find\x20proxy\x20server','ldap://','unbind','push','dnuser','params','error:\x20','status','check','_id','El\x20vinculo\x20ha\x20sido\x20realizado\x20correctamente','catch','done','__awaiter','Lo\x20sentimos\x20los\x20datos\x20de\x20autenticación\x20son\x20incorrectos','object','search','throw','port','destroy','dnbase','test','__esModule','find','next','servers','ldapjs','1787112gigyPW','proxyservers','custom','notEmpty','source','value','run','populate','execPopulate','sub','filter','collection','find\x20ldap\x20server','getSourceInfo','1158195WucuZf','2321379LQhrIp','array','bind','updateOne','Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20del\x20servidor\x20proxy','2659370ImahUY','findByIdAndDelete','password','then'];a47_0x1587=function(){return _0x4fbad1;};return a47_0x1587();}var __awaiter=this&&this[a47_0x191349(0xeb)]||function(_0x459f7b,_0x1d42ba,_0x3ef17b,_0x473083){function _0x25c72e(_0x142029){return _0x142029 instanceof _0x3ef17b?_0x142029:new _0x3ef17b(function(_0x4c8008){_0x4c8008(_0x142029);});}return new(_0x3ef17b||(_0x3ef17b=Promise))(function(_0xbcc5b8,_0x23544b){const _0x20793e=a47_0x1143;function _0x5dd239(_0x120053){const _0x4c3e5b=a47_0x1143;try{_0x59b68e(_0x473083[_0x4c3e5b(0xf6)](_0x120053));}catch(_0x18cfe2){_0x23544b(_0x18cfe2);}}function _0x279fb5(_0x29f89e){const _0x254d18=a47_0x1143;try{_0x59b68e(_0x473083[_0x254d18(0xef)](_0x29f89e));}catch(_0x210e27){_0x23544b(_0x210e27);}}function _0x59b68e(_0x39b3f6){const _0x3aed2=a47_0x1143;_0x39b3f6[_0x3aed2(0xea)]?_0xbcc5b8(_0x39b3f6[_0x3aed2(0xfe)]):_0x25c72e(_0x39b3f6['value'])[_0x3aed2(0x110)](_0x5dd239,_0x279fb5);}_0x59b68e((_0x473083=_0x473083[_0x20793e(0xd4)](_0x459f7b,_0x1d42ba||[]))[_0x20793e(0xf6)]());});};Object['defineProperty'](exports,a47_0x191349(0xf4),{'value':!![]}),exports[a47_0x191349(0xda)]=exports[a47_0x191349(0x106)]=exports['linkProxyServer']=exports[a47_0x191349(0x118)]=exports['getLdapServers']=void 0x0;const express_validator_1=require(a47_0x191349(0xc4)),ServerLdap_1=require(a47_0x191349(0x11a)),Server_1=require(a47_0x191349(0xd6)),ldap=require(a47_0x191349(0xf8)),getLdapServers=(_0x2ffe74,_0x25e5e9)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x367dd5=a47_0x191349;let _0x578a0c=yield ServerLdap_1[_0x367dd5(0x11c)][_0x367dd5(0xf5)]()[_0x367dd5(0x110)](_0x1f6a17=>{return _0x1f6a17;})[_0x367dd5(0xe9)](_0x2840eb=>{const _0xd06e2f=_0x367dd5;return{'errors':[{'location':'getLdapServers','msg':'Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20de\x20los\x20servidores\x20LDAP','param':_0xd06e2f(0xf7)}]};});return _0x25e5e9['json'](_0x578a0c);});exports[a47_0x191349(0xcf)]=getLdapServers;const register=(_0x105a3f,_0x247a3f)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x128cf5=a47_0x191349;yield express_validator_1['check']('host')[_0x128cf5(0xfc)]()[_0x128cf5(0x124)](_0x128cf5(0xce))[_0x128cf5(0xff)](_0x105a3f);const _0x250e19=_0x484701=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x5b9f00=_0x128cf5;if(!/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/[_0x5b9f00(0xf3)](_0x105a3f[_0x5b9f00(0x115)]['host']))return Promise[_0x5b9f00(0xd2)](_0x5b9f00(0x123));}),_0x9d4692=_0x162a03=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x3f7bac=_0x128cf5;return yield ServerLdap_1[_0x3f7bac(0x11c)]['findOne']({'host':_0x105a3f[_0x3f7bac(0x115)]['host']})[_0x3f7bac(0x110)](_0x268ea1=>{const _0x1d4494=_0x3f7bac;if(_0x268ea1)return Promise[_0x1d4494(0xd2)]('host_found');});});yield express_validator_1['check'](_0x128cf5(0x122))[_0x128cf5(0xfb)](_0x250e19)['run'](_0x105a3f),yield express_validator_1[_0x128cf5(0xe6)](_0x128cf5(0x122))[_0x128cf5(0xfb)](_0x9d4692)['run'](_0x105a3f);const _0x5c7e62=express_validator_1[_0x128cf5(0xcd)](_0x105a3f);if(!_0x5c7e62[_0x128cf5(0xc5)]())return _0x247a3f[_0x128cf5(0xe5)](0x190)[_0x128cf5(0x11b)]({'errors':_0x5c7e62[_0x128cf5(0x109)]()});const _0x4dc4fa=ldap[_0x128cf5(0x111)]({'url':[_0x128cf5(0xdf)+_0x105a3f[_0x128cf5(0x115)][_0x128cf5(0x122)]+':'+_0x105a3f['body'][_0x128cf5(0xf0)]],'reconnect':!![]});yield _0x4dc4fa['bind'](_0x105a3f[_0x128cf5(0x115)][_0x128cf5(0xe2)],_0x105a3f[_0x128cf5(0x115)][_0x128cf5(0x10f)],_0x4248c7=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x3543cd=_0x128cf5;if(_0x4248c7)return _0x247a3f[_0x3543cd(0x11b)]({'errors':[{'location':_0x3543cd(0x118),'msg':'Lo\x20sentimos\x20los\x20datos\x20de\x20autenticación\x20son\x20incorrectos','param':_0x3543cd(0xcb)}]});else yield _0x4dc4fa['search'](_0x105a3f[_0x3543cd(0x115)]['dnbase'],{},function(_0x4d0c98,_0x3c6684){const _0x500293=_0x3543cd;if(_0x4d0c98)return _0x247a3f['json']({'errors':[{'location':_0x500293(0x118),'msg':_0x500293(0x121),'param':_0x500293(0xcb)}]});else _0x3c6684['on'](_0x500293(0x11e),function(_0x1a3b62){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4cec9e=a47_0x1143;let _0x3e7314=new ServerLdap_1[(_0x4cec9e(0x11d))]({'host':_0x105a3f[_0x4cec9e(0x115)]['host'],'port':_0x105a3f[_0x4cec9e(0x115)][_0x4cec9e(0xf0)],'dnbase':_0x105a3f[_0x4cec9e(0x115)][_0x4cec9e(0xf2)],'dnuser':_0x105a3f[_0x4cec9e(0x115)]['dnuser'],'encryption':_0x105a3f['body'][_0x4cec9e(0xd3)],'password':_0x105a3f[_0x4cec9e(0x115)]['password']});return yield ServerLdap_1[_0x4cec9e(0x11c)]['create'](_0x3e7314,(_0x3dd66f,_0x17005a)=>{const _0x31abb6=_0x4cec9e;if(_0x3dd66f)return _0x247a3f['json']({'errors':[{'location':'register','msg':_0x31abb6(0x117),'param':_0x31abb6(0xcb)}]});else return _0x247a3f['json'](_0x17005a);});});}),_0x3c6684['on']('error',function(_0xefe896){const _0x1231ad=_0x500293;return console[_0x1231ad(0x116)](_0x1231ad(0xe4)+_0xefe896[_0x1231ad(0x112)]),_0x247a3f[_0x1231ad(0x11b)]({'errors':[{'location':_0x1231ad(0x118),'msg':_0x1231ad(0xd1),'param':_0x1231ad(0xcb)}]});});});}));});exports[a47_0x191349(0x118)]=register;const linkProxyServer=(_0x59b664,_0x3b86a6)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x2f4001=a47_0x191349;yield ServerLdap_1[_0x2f4001(0x11c)]['findById'](_0x59b664[_0x2f4001(0x115)]['ldapid'])['populate'](_0x2f4001(0xfa))['then'](_0x434a27=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x16a8b7=_0x2f4001;yield Server_1[_0x16a8b7(0x113)][_0x16a8b7(0xd9)](_0x59b664[_0x16a8b7(0x115)]['proxyid'])[_0x16a8b7(0x100)](_0x16a8b7(0xdd))[_0x16a8b7(0x110)](_0x3166ff=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x1bb88f=_0x16a8b7;if(_0x59b664['body']['ldapid']=='noldapserver'){if(_0x3166ff[_0x1bb88f(0xdd)]!==undefined){let _0x1109da=yield _0x3166ff[_0x1bb88f(0xdd)][_0x1bb88f(0x100)](_0x1bb88f(0xfa))[_0x1bb88f(0x101)](),_0x4b7b01=_0x1109da[_0x1bb88f(0xfa)][_0x1bb88f(0x103)](function(_0x8b5ae6){const _0x3dec4b=_0x1bb88f;return _0x8b5ae6[_0x3dec4b(0x122)]!=_0x3166ff[_0x3dec4b(0x122)];});return _0x1109da[_0x1bb88f(0xfa)]=_0x4b7b01,_0x1109da[_0x1bb88f(0xc2)](),yield Server_1[_0x1bb88f(0x113)][_0x1bb88f(0x104)][_0x1bb88f(0x10b)]({'_id':_0x3166ff['_id']},{'$unset':{'serverldap':0x1}}),_0x3b86a6['json']({'status':'serverldapdeleted','msg':_0x1bb88f(0xd8)});}else return _0x3b86a6['json']({'status':'nothingtodo','msg':'Nada\x20que\x20hacer\x20con\x20el\x20servidor\x20ldap'});}else{let _0xe13e91=_0x434a27[_0x1bb88f(0xfa)][_0x1bb88f(0x103)](function(_0x5bdfd1){const _0x24ee61=_0x1bb88f;return _0x5bdfd1['host']==_0x3166ff[_0x24ee61(0x122)];});if(_0xe13e91[_0x1bb88f(0xdc)]>0x0)return _0x3b86a6[_0x1bb88f(0x11b)]({'errors':[{'location':_0x1bb88f(0xdb),'msg':'Lo\x20sentimos\x20el\x20servidor\x20proxy\x20ya\x20está\x20vinculado\x20a\x20este\x20servidor\x20LDAP'}]});else{if(_0x3166ff[_0x1bb88f(0xdd)]){let _0x475c6e=yield _0x3166ff['serverldap'][_0x1bb88f(0x100)](_0x1bb88f(0xfa))[_0x1bb88f(0x101)](),_0x4623e3=_0x475c6e[_0x1bb88f(0xfa)][_0x1bb88f(0x103)](function(_0x3917b0){const _0x286fbf=_0x1bb88f;return _0x3917b0[_0x286fbf(0x122)]!=_0x3166ff['host'];});_0x475c6e[_0x1bb88f(0xfa)]=_0x4623e3,_0x475c6e[_0x1bb88f(0xc2)]();}return _0x3166ff[_0x1bb88f(0xdd)]=_0x434a27[_0x1bb88f(0xe7)],_0x3166ff['save'](),_0x434a27[_0x1bb88f(0xfa)][_0x1bb88f(0xe1)](_0x3166ff),_0x434a27['save'](),_0x3b86a6['json']({'status':'ok','msg':_0x1bb88f(0xe8)});}}}))[_0x16a8b7(0xe9)](_0x44290a=>{const _0x218e17=_0x16a8b7;return _0x3b86a6[_0x218e17(0x11b)]({'errors':[{'location':_0x218e17(0xde),'msg':_0x218e17(0x10c),'param':'servers'}]});});}))[_0x2f4001(0xe9)](_0xcc34=>{const _0x22a807=_0x2f4001;return _0x3b86a6[_0x22a807(0x11b)]({'errors':[{'location':_0x22a807(0x105),'msg':'Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20del\x20servidor\x20LDAP','param':'servers'}]});});});exports[a47_0x191349(0x11f)]=linkProxyServer;const getSourceInfo=(_0x58fe3d,_0x3bcc90)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x3ac520=a47_0x191349;yield Server_1[_0x3ac520(0x113)][_0x3ac520(0xc6)]({'host':_0x58fe3d[_0x3ac520(0x115)][_0x3ac520(0x122)]})[_0x3ac520(0x100)](_0x3ac520(0xdd))[_0x3ac520(0x110)](_0x125771=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x1dfe1b=_0x3ac520;if(_0x125771){if(_0x125771[_0x1dfe1b(0xdd)]){const _0x3532c4=ldap['createClient']({'url':[_0x1dfe1b(0xdf)+_0x125771[_0x1dfe1b(0xdd)]['host']+':'+_0x125771['serverldap']['port']]});yield _0x3532c4[_0x1dfe1b(0x10a)](_0x125771['serverldap']['dnuser'],_0x125771[_0x1dfe1b(0xdd)][_0x1dfe1b(0x10f)],_0x451b25=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x4e412c=_0x1dfe1b;if(_0x451b25)return _0x3532c4[_0x4e412c(0xe0)](),_0x3532c4['destroy'](),_0x3bcc90[_0x4e412c(0x11b)]({'errors':[{'location':'auth\x20ldap\x20server','msg':_0x4e412c(0xec),'param':_0x4e412c(0xf7)}]});else{var _0x3d251e={'filter':'samaccountname='+_0x58fe3d[_0x4e412c(0x115)][_0x4e412c(0xfd)],'scope':_0x4e412c(0x102)};yield _0x3532c4[_0x4e412c(0xee)](_0x125771[_0x4e412c(0xdd)][_0x4e412c(0xf2)],_0x3d251e,function(_0x136735,_0x4facc3){const _0x56eabb=_0x4e412c;if(_0x136735)return _0x3532c4['unbind'](),_0x3532c4[_0x56eabb(0xf1)](),_0x3bcc90[_0x56eabb(0x11b)]({'errors':[{'location':_0x56eabb(0x119),'msg':_0x56eabb(0x121),'param':_0x56eabb(0xf7)}]});else _0x4facc3['on']('searchEntry',function(_0x807ad){const _0x753a2e=_0x56eabb;return _0x3532c4[_0x753a2e(0xe0)](),_0x3532c4[_0x753a2e(0xf1)](),_0x3bcc90[_0x753a2e(0x11b)](_0x807ad[_0x753a2e(0xed)]);}),_0x4facc3['on'](_0x56eabb(0x116),function(_0x1f9e99){const _0x5edf57=_0x56eabb;return _0x3532c4[_0x5edf57(0xe0)](),_0x3532c4[_0x5edf57(0xf1)](),_0x3bcc90[_0x5edf57(0x11b)]({'errors':[{'location':_0x5edf57(0xc9),'msg':_0x5edf57(0xca),'param':_0x5edf57(0xf7)}]});});});}}));}else return _0x3bcc90[_0x1dfe1b(0x11b)]({'errors':[{'location':_0x1dfe1b(0x105),'msg':'Lo\x20sentimos\x20el\x20servidor\x20proxy\x20no\x20tiene\x20ningún\x20servidor\x20LDAP\x20asociado','param':_0x1dfe1b(0xf7)}]});}else return _0x3bcc90[_0x1dfe1b(0x11b)]({'errors':[{'location':'find\x20proxy\x20server','msg':'Lo\x20sentimos\x20este\x20servidor\x20proxy\x20no\x20se\x20encuentra\x20registrado','param':_0x1dfe1b(0xf7)}]});}))[_0x3ac520(0xe9)](_0x4e46de=>{const _0x4e96f4=_0x3ac520;return _0x3bcc90[_0x4e96f4(0x11b)]({'errors':[{'location':_0x4e96f4(0xde),'msg':'Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20del\x20servidor\x20proxy','param':'servers'}]});});});function a47_0x1143(_0x4976ed,_0x29c7e1){const _0x1587a4=a47_0x1587();return a47_0x1143=function(_0x114310,_0x5f30c6){_0x114310=_0x114310-0xc2;let _0x3bd234=_0x1587a4[_0x114310];return _0x3bd234;},a47_0x1143(_0x4976ed,_0x29c7e1);}exports[a47_0x191349(0x106)]=getSourceInfo;const deleteServer=(_0x59866a,_0x5376c9)=>{const _0x2f4cb3=a47_0x191349;ServerLdap_1[_0x2f4cb3(0x11c)][_0x2f4cb3(0xd9)](_0x59866a[_0x2f4cb3(0xe3)]['id'])[_0x2f4cb3(0x100)](_0x2f4cb3(0xfa))['then'](_0x59118b=>{const _0x47c406=_0x2f4cb3;if(_0x59118b)_0x59118b['proxyservers']!==undefined&&_0x59118b['proxyservers'][_0x47c406(0xdc)]>0x0&&_0x59118b[_0x47c406(0xfa)][_0x47c406(0x114)]((_0x342be6,_0x314a43)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x33aa44=_0x47c406;yield Server_1[_0x33aa44(0x113)][_0x33aa44(0x104)][_0x33aa44(0x10b)]({'_id':_0x342be6[_0x33aa44(0xe7)]},{'$unset':{'serverldap':0x1}});})),ServerLdap_1[_0x47c406(0x11c)][_0x47c406(0x10e)](_0x59866a['params']['id'])[_0x47c406(0x110)](()=>{const _0x4fe412=_0x47c406;return _0x5376c9[_0x4fe412(0x11b)](_0x59118b);})['catch'](_0x29ddac=>{const _0x42b764=_0x47c406;return _0x5376c9[_0x42b764(0x11b)]({'errors':[{'location':_0x42b764(0xdb),'msg':'Lo\x20sentimos\x20no\x20se\x20pudo\x20eliminar\x20el\x20servidor\x20LDAP','param':'connection'}]});});else return _0x5376c9[_0x47c406(0x11b)]({'errors':[{'location':'delete','msg':_0x47c406(0xc3),'param':'host'}]});})[_0x2f4cb3(0xe9)](_0x1595ea=>{const _0x1416d7=_0x2f4cb3;return _0x5376c9[_0x1416d7(0x11b)]({'errors':[{'location':_0x1416d7(0x120),'msg':'Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20del\x20servidor\x20LDAP','param':_0x1416d7(0xd0)}]});});};exports[a47_0x191349(0xda)]=deleteServer;