'use strict';const a8_0x331e2d=a8_0xcd0a;function a8_0x7538(){const _0x2cda7d=['updatedquota','done','update','1SVRaNP','quotadeleted','isdefault','identifier','withMessage','Cuota\x20eliminada\x20de\x20por\x20defecto\x20correctamente','5YsHqqq','linkSource','Lo\x20sentimos\x20no\x20se\x20pudo\x20eliminar\x20la\x20cuota','self','type','_id','Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20del\x20servidor','run','Esta\x20cuota\x20ya\x20es\x20la\x20cuota\x20por\x20defecto','throw','body','notEmpty','Nada\x20que\x20hacer\x20con\x20la\x20cuota','../models/Server','value','save','nodefault','sources','limit_empty','limit','quota','json','1112715pmRjHF','findOne','findByIdAndUpdate','Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20de\x20la\x20cuota','quotaid','host','restartQuota','getQuotas','reject','execPopulate','7935633FqrtKZ','2297813pXxqGg','params','Cuota\x20establecida\x20correctamente','type_empty','then','express-validator','custom','../models/Quota','Source','find','register','1336494votqAz','nothingtodo','Esta\x20cuota\x20ya\x20estÃ¡\x20establecidad\x20para\x20','populate','deleteQuota','Quota','next','1250388QNWliU','Cuota\x20establecida\x20por\x20defecto\x20correctamente','collection','Lo\x20sentimos\x20no\x20se\x20pudo\x20registrar\x20la\x20cuota','deleted','611944WKORiY','filter','connection','deletedquota','2034648yTWdaL','delete','push','getServers','updateOne','findserver','check','__esModule','catch','isEmpty','Server','map','QuotaInterface','setDefault','length','create'];a8_0x7538=function(){return _0x2cda7d;};return a8_0x7538();}(function(_0x175edf,_0x27d5b5){const _0x34d8d5=a8_0xcd0a,_0x1a34e0=_0x175edf();while(!![]){try{const _0x8bfa22=-parseInt(_0x34d8d5(0xc4))/0x1*(-parseInt(_0x34d8d5(0xad))/0x2)+parseInt(_0x34d8d5(0x8b))/0x3+-parseInt(_0x34d8d5(0xa8))/0x4*(parseInt(_0x34d8d5(0xca))/0x5)+-parseInt(_0x34d8d5(0xa1))/0x6+-parseInt(_0x34d8d5(0x96))/0x7+-parseInt(_0x34d8d5(0xb1))/0x8+parseInt(_0x34d8d5(0x95))/0x9;if(_0x8bfa22===_0x27d5b5)break;else _0x1a34e0['push'](_0x1a34e0['shift']());}catch(_0x5dc743){_0x1a34e0['push'](_0x1a34e0['shift']());}}}(a8_0x7538,0x6b966));var __awaiter=this&&this['__awaiter']||function(_0x687b43,_0xac9486,_0x33954f,_0x261708){function _0x2006d0(_0xfed9af){return _0xfed9af instanceof _0x33954f?_0xfed9af:new _0x33954f(function(_0x3fb02c){_0x3fb02c(_0xfed9af);});}return new(_0x33954f||(_0x33954f=Promise))(function(_0x1e3b80,_0x4d5c94){const _0x36efaa=a8_0xcd0a;function _0x2d0483(_0x8c9896){try{_0x2624ea(_0x261708['next'](_0x8c9896));}catch(_0x5def34){_0x4d5c94(_0x5def34);}}function _0x3f5c0e(_0x449e6c){const _0x1ce7cc=a8_0xcd0a;try{_0x2624ea(_0x261708[_0x1ce7cc(0xd3)](_0x449e6c));}catch(_0x98fe2c){_0x4d5c94(_0x98fe2c);}}function _0x2624ea(_0x301d15){const _0x48b34c=a8_0xcd0a;_0x301d15[_0x48b34c(0xc2)]?_0x1e3b80(_0x301d15['value']):_0x2006d0(_0x301d15[_0x48b34c(0xd8)])[_0x48b34c(0x9a)](_0x2d0483,_0x3f5c0e);}_0x2624ea((_0x261708=_0x261708['apply'](_0x687b43,_0xac9486||[]))[_0x36efaa(0xa7)]());});};Object['defineProperty'](exports,a8_0x331e2d(0xb8),{'value':!![]}),exports['restartQuota']=exports[a8_0x331e2d(0xbe)]=exports['deleteQuota']=exports['linkSource']=exports[a8_0x331e2d(0xa0)]=exports[a8_0x331e2d(0x92)]=void 0x0;function a8_0xcd0a(_0x186659,_0x1804b1){const _0x7538ef=a8_0x7538();return a8_0xcd0a=function(_0xcd0ab9,_0x40c28f){_0xcd0ab9=_0xcd0ab9-0x8a;let _0x42bb17=_0x7538ef[_0xcd0ab9];return _0x42bb17;},a8_0xcd0a(_0x186659,_0x1804b1);}const express_validator_1=require(a8_0x331e2d(0x9b)),Quota_1=require(a8_0x331e2d(0x9d)),Source_1=require('../models/Source'),Server_1=require(a8_0x331e2d(0xd7)),getQuotas=(_0x537e47,_0x8054f4)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x515437=a8_0x331e2d;let _0x585550=yield Quota_1[_0x515437(0xa6)]['find']()[_0x515437(0x9a)](_0x5bed97=>{return _0x5bed97;})['catch'](_0x302bbe=>{const _0x1f8a80=_0x515437;return{'errors':[{'location':_0x1f8a80(0xb4),'msg':'Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20de\x20las\x20cuotas','param':'servers'}]};});return _0x585550['sort']((_0x146787,_0x337b94)=>_0x337b94['isdefault']-_0x146787[_0x515437(0xc6)]),_0x8054f4[_0x515437(0x8a)](_0x585550);});exports[a8_0x331e2d(0x92)]=getQuotas;const register=(_0x2a5393,_0x5dc795)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x1df5e6=a8_0x331e2d;yield express_validator_1[_0x1df5e6(0xb7)](_0x1df5e6(0xdd))['notEmpty']()[_0x1df5e6(0xc8)](_0x1df5e6(0xdc))[_0x1df5e6(0xd1)](_0x2a5393),yield express_validator_1[_0x1df5e6(0xb7)](_0x1df5e6(0xce))[_0x1df5e6(0xd5)]()[_0x1df5e6(0xc8)](_0x1df5e6(0x99))[_0x1df5e6(0xd1)](_0x2a5393);const _0x72cda0=_0x107ce9=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x8a825=_0x1df5e6;return yield Quota_1[_0x8a825(0xa6)][_0x8a825(0x8c)]({'limit':_0x2a5393[_0x8a825(0xd4)][_0x8a825(0xdd)],'type':_0x2a5393[_0x8a825(0xd4)][_0x8a825(0xce)]})[_0x8a825(0x9a)](_0x186633=>{const _0x4660a3=_0x8a825;if(_0x186633)return Promise[_0x4660a3(0x93)]('Lo\x20sentimos\x20esta\x20cuota\x20ya\x20se\x20encuentra\x20registrada');});});yield express_validator_1[_0x1df5e6(0xb7)](_0x1df5e6(0x90))[_0x1df5e6(0x9c)](_0x72cda0)[_0x1df5e6(0xd1)](_0x2a5393);const _0x12804c=express_validator_1['validationResult'](_0x2a5393);if(!_0x12804c[_0x1df5e6(0xba)]())return _0x5dc795[_0x1df5e6(0x8a)]({'errors':_0x12804c['array']()});let _0x271087=new Quota_1[(_0x1df5e6(0xbd))]({'limit':_0x2a5393[_0x1df5e6(0xd4)][_0x1df5e6(0xdd)],'type':_0x2a5393['body']['type'],'isdefault':![]});return yield Quota_1[_0x1df5e6(0xa6)][_0x1df5e6(0xc0)](_0x271087,(_0x2e7317,_0x4b79cc)=>{const _0x3a38fa=_0x1df5e6;if(_0x2e7317)return _0x5dc795[_0x3a38fa(0x8a)]({'errors':[{'location':'register','msg':_0x3a38fa(0xab)}]});else return _0x5dc795[_0x3a38fa(0x8a)](_0x4b79cc);});});exports[a8_0x331e2d(0xa0)]=register;const linkSource=(_0x367cb9,_0x3d5e59)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x5095a4=a8_0x331e2d;Server_1[_0x5095a4(0xbb)][_0x5095a4(0x8c)]({'host':_0x367cb9[_0x5095a4(0xd4)][_0x5095a4(0x90)]})[_0x5095a4(0xa4)](_0x5095a4(0xdb))[_0x5095a4(0x9a)](_0x1ab05c=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x26b0e0=_0x5095a4;let _0x297e69=_0x1ab05c[_0x26b0e0(0xdb)]['filter'](function(_0x41a9d8){const _0x3fa8de=_0x26b0e0;return _0x41a9d8['identifier']==_0x367cb9[_0x3fa8de(0xd4)]['identifier'];})[0x0];if(_0x367cb9[_0x26b0e0(0xd4)][_0x26b0e0(0x8f)]=='noquota'){if(_0x297e69['quota']!==undefined){yield _0x297e69[_0x26b0e0(0xa4)](_0x26b0e0(0xde))[_0x26b0e0(0x94)]();let _0xcca34c=yield _0x297e69[_0x26b0e0(0xde)][_0x26b0e0(0xa4)]('sources')[_0x26b0e0(0x94)](),_0x1f1070=_0xcca34c[_0x26b0e0(0xdb)]['filter'](function(_0x19794d){const _0x1a233d=_0x26b0e0;return _0x19794d['identifier']!=_0x367cb9[_0x1a233d(0xd4)][_0x1a233d(0xc7)];});return _0xcca34c[_0x26b0e0(0xdb)]=_0x1f1070,_0xcca34c[_0x26b0e0(0xd9)](),yield Source_1[_0x26b0e0(0x9e)]['collection'][_0x26b0e0(0xb5)]({'_id':_0x297e69['_id']},{'$unset':{'quota':0x1}}),_0x3d5e59[_0x26b0e0(0x8a)]({'status':_0x26b0e0(0xc5),'msg':'Cuota\x20eliminada\x20correctamente'});}else return _0x3d5e59['json']({'status':_0x26b0e0(0xa2),'msg':_0x26b0e0(0xd6)});}else yield Quota_1[_0x26b0e0(0xa6)][_0x26b0e0(0x8c)]({'_id':_0x367cb9[_0x26b0e0(0xd4)][_0x26b0e0(0x8f)]})[_0x26b0e0(0xa4)](_0x26b0e0(0xdb))[_0x26b0e0(0x9a)](_0x395af9=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x366bb8=_0x26b0e0;let _0x5619a3=_0x395af9[_0x366bb8(0xdb)][_0x366bb8(0xae)](function(_0x190c21){const _0xd0ddf6=_0x366bb8;return _0x190c21['identifier']==_0x367cb9[_0xd0ddf6(0xd4)][_0xd0ddf6(0xc7)];});if(_0x5619a3[_0x366bb8(0xbf)]>0x0)return _0x3d5e59['json']({'errors':[{'location':_0x366bb8(0xc3),'msg':_0x366bb8(0xa3)+_0x297e69['identifier']}]});else{if(_0x297e69[_0x366bb8(0xde)]){yield _0x297e69[_0x366bb8(0xa4)]('quota')['execPopulate']();let _0x2cb208=yield _0x297e69[_0x366bb8(0xde)][_0x366bb8(0xa4)](_0x366bb8(0xdb))[_0x366bb8(0x94)](),_0x209058=_0x2cb208[_0x366bb8(0xdb)][_0x366bb8(0xae)](function(_0x2f6122){const _0x115080=_0x366bb8;return _0x2f6122[_0x115080(0xc7)]!=_0x367cb9[_0x115080(0xd4)][_0x115080(0xc7)];});_0x2cb208[_0x366bb8(0xdb)]=_0x209058,_0x2cb208[_0x366bb8(0xd9)]();}return _0x297e69[_0x366bb8(0xde)]=_0x395af9[_0x366bb8(0xcf)],_0x297e69[_0x366bb8(0xd9)](),_0x395af9[_0x366bb8(0xdb)][_0x366bb8(0xb3)](_0x297e69),_0x395af9[_0x366bb8(0xd9)](),_0x3d5e59[_0x366bb8(0x8a)]({'status':'ok','msg':_0x366bb8(0x98)});}}))[_0x26b0e0(0xb9)](_0x15d933=>{const _0x5276c3=_0x26b0e0;return _0x3d5e59[_0x5276c3(0x8a)]({'errors':[{'location':_0x5276c3(0xc3),'msg':_0x5276c3(0x8e),'param':_0x5276c3(0xaf)}]});});}))[_0x5095a4(0xb9)](_0x43a1ba=>{const _0x42621e=_0x5095a4;return _0x3d5e59['json']({'errors':[{'location':'update','msg':_0x42621e(0xd0),'param':_0x42621e(0xaf)}]});});});exports[a8_0x331e2d(0xcb)]=linkSource;const deleteQuota=(_0x13f336,_0x2524b9)=>{const _0xe3fdd4=a8_0x331e2d;Quota_1['Quota']['findById'](_0x13f336[_0xe3fdd4(0x97)]['id'])[_0xe3fdd4(0xa4)](_0xe3fdd4(0xdb))[_0xe3fdd4(0x9a)](_0x170bd7=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x125344=_0xe3fdd4;if(_0x170bd7)_0x170bd7[_0x125344(0xdb)][_0x125344(0xbc)]((_0x31426b,_0x46a261)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x70948d=_0x125344;yield Source_1['Source'][_0x70948d(0xaa)][_0x70948d(0xb5)]({'_id':_0x31426b['_id']},{'$unset':{'quota':0x1}});})),Quota_1[_0x125344(0xa6)]['findByIdAndDelete'](_0x13f336[_0x125344(0x97)]['id'])[_0x125344(0x9a)](()=>{const _0x48e488=_0x125344;return _0x2524b9[_0x48e488(0x8a)](_0x170bd7);})[_0x125344(0xb9)](_0x196393=>{const _0x25434c=_0x125344;return _0x2524b9['json']({'errors':[{'location':_0x25434c(0xc3),'msg':_0x25434c(0xcc),'param':'connection'}]});});else return _0x2524b9[_0x125344(0x8a)]({'errors':[{'location':_0x125344(0xb2),'msg':'Lo\x20sentimos\x20esta\x20cuota\x20no\x20se\x20encuentra\x20registrada','param':_0x125344(0x90)}]});}))['catch'](_0x3078b5=>{const _0x1c30b8=_0xe3fdd4;return _0x2524b9[_0x1c30b8(0x8a)]({'errors':[{'location':_0x1c30b8(0xb2),'msg':'Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20de\x20la\x20cuota','param':_0x1c30b8(0xb6)}]});});};exports[a8_0x331e2d(0xa5)]=deleteQuota;const setDefault=(_0x5085ce,_0x236993)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x5e1661=a8_0x331e2d;let _0x3be6bc='';yield Quota_1[_0x5e1661(0xa6)]['findOne']({'isdefault':!![]})[_0x5e1661(0x9a)](_0x4c9913=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x560eee=_0x5e1661;if(_0x4c9913){if(_0x4c9913['_id']==_0x5085ce[_0x560eee(0x97)]['id'])_0x3be6bc='self';else yield Quota_1[_0x560eee(0xa6)][_0x560eee(0x8d)](_0x4c9913[_0x560eee(0xcf)],{'isdefault':![]},{'new':!![]}),_0x3be6bc=_0x560eee(0xac);}}))[_0x5e1661(0xb9)](_0x5ed390=>{const _0x39875c=_0x5e1661;return _0x236993[_0x39875c(0x8a)]({'errors':[{'location':_0x39875c(0xc3),'msg':_0x39875c(0x8e)}]});});if(_0x3be6bc==_0x5e1661(0xcd))return _0x236993[_0x5e1661(0x8a)]({'errors':[{'location':_0x5e1661(0xc3),'msg':_0x5e1661(0xd2)}]});else{if(_0x5085ce[_0x5e1661(0xd4)][_0x5e1661(0x8f)]!=_0x5e1661(0xda))yield Quota_1[_0x5e1661(0xa6)]['findById'](_0x5085ce[_0x5e1661(0x97)]['id'])[_0x5e1661(0x9a)](_0x392811=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x570a06=_0x5e1661;if(_0x392811)yield Quota_1[_0x570a06(0xa6)][_0x570a06(0x8d)](_0x5085ce[_0x570a06(0x97)]['id'],{'isdefault':!![]},{'new':!![]})[_0x570a06(0x9a)](_0x3f221a=>{const _0x2bc51f=_0x570a06;return _0x236993[_0x2bc51f(0x8a)]({'status':_0x2bc51f(0xc1),'msg':_0x2bc51f(0xa9)});})[_0x570a06(0xb9)](_0x29abdd=>{const _0x1970d5=_0x570a06;return _0x236993[_0x1970d5(0x8a)]({'errors':[{'location':_0x1970d5(0xc3),'msg':'Lo\x20sentimos\x20no\x20se\x20pudo\x20actualizar\x20la\x20cuota','param':_0x1970d5(0xaf)}]});});else return _0x236993['json']({'errors':[{'location':_0x570a06(0xb2),'msg':'Lo\x20sentimos\x20esta\x20cuota\x20no\x20se\x20encuentra\x20registrada','param':_0x570a06(0x90)}]});}))['catch'](_0x472e5c=>{const _0x192cfb=_0x5e1661;return _0x236993[_0x192cfb(0x8a)]({'errors':[{'location':_0x192cfb(0xb2),'msg':_0x192cfb(0x8e),'param':'findserver'}]});});else{if(_0x3be6bc==_0x5e1661(0xac))return _0x236993[_0x5e1661(0x8a)]({'status':_0x5e1661(0xb0),'msg':_0x5e1661(0xc9)});else return _0x236993[_0x5e1661(0x8a)]({'status':_0x5e1661(0xa2),'msg':'Nada\x20que\x20hacer\x20con\x20la\x20cuota'});}}});exports[a8_0x331e2d(0xbe)]=setDefault;const restartQuota=_0x179bf9=>{const _0x28a87c=a8_0x331e2d;Quota_1[_0x28a87c(0xa6)][_0x28a87c(0x9f)]({'type':_0x179bf9})[_0x28a87c(0xa4)](_0x28a87c(0xdb))[_0x28a87c(0x9a)](_0xf7a708=>{_0xf7a708['map']((_0x4a7f46,_0x3749ff)=>{const _0x35dfe1=a8_0xcd0a;_0x4a7f46['sources'][_0x35dfe1(0xbc)]((_0x489fb5,_0x3c60f7)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x59e1e4=_0x35dfe1;yield Source_1[_0x59e1e4(0x9e)][_0x59e1e4(0x8d)]({'_id':_0x489fb5[_0x59e1e4(0xcf)]},{'quota_consumed':0x0});}));});});};exports[a8_0x331e2d(0x91)]=restartQuota;