'use strict';const a8_0x4136ca=a8_0x482d;(function(_0x4c3601,_0x17914e){const _0x5ac536=a8_0x482d,_0x9286b9=_0x4c3601();while(!![]){try{const _0x10805f=parseInt(_0x5ac536(0xd5))/0x1+-parseInt(_0x5ac536(0xee))/0x2*(-parseInt(_0x5ac536(0xff))/0x3)+parseInt(_0x5ac536(0xd7))/0x4+-parseInt(_0x5ac536(0xc3))/0x5+-parseInt(_0x5ac536(0xf7))/0x6*(parseInt(_0x5ac536(0xde))/0x7)+parseInt(_0x5ac536(0xba))/0x8*(-parseInt(_0x5ac536(0xca))/0x9)+-parseInt(_0x5ac536(0xdc))/0xa*(-parseInt(_0x5ac536(0xdb))/0xb);if(_0x10805f===_0x17914e)break;else _0x9286b9['push'](_0x9286b9['shift']());}catch(_0x2d4f11){_0x9286b9['push'](_0x9286b9['shift']());}}}(a8_0x130d,0x5b15e));var __awaiter=this&&this['__awaiter']||function(_0x23de12,_0x1ac0ae,_0x258605,_0x1cc8e9){function _0x475702(_0xccc863){return _0xccc863 instanceof _0x258605?_0xccc863:new _0x258605(function(_0x1441d7){_0x1441d7(_0xccc863);});}return new(_0x258605||(_0x258605=Promise))(function(_0x2d50cb,_0x43e5d9){const _0x43a0f=a8_0x482d;function _0x3a19a3(_0x639ce8){try{_0x5178af(_0x1cc8e9['next'](_0x639ce8));}catch(_0x39ed8a){_0x43e5d9(_0x39ed8a);}}function _0x49c981(_0x298313){const _0x59b705=a8_0x482d;try{_0x5178af(_0x1cc8e9[_0x59b705(0xfd)](_0x298313));}catch(_0x15c175){_0x43e5d9(_0x15c175);}}function _0x5178af(_0x2613e8){const _0x4743e2=a8_0x482d;_0x2613e8[_0x4743e2(0x105)]?_0x2d50cb(_0x2613e8[_0x4743e2(0xb2)]):_0x475702(_0x2613e8[_0x4743e2(0xb2)])[_0x4743e2(0xc4)](_0x3a19a3,_0x49c981);}_0x5178af((_0x1cc8e9=_0x1cc8e9['apply'](_0x23de12,_0x1ac0ae||[]))[_0x43a0f(0xf0)]());});};Object[a8_0x4136ca(0xdd)](exports,'__esModule',{'value':!![]}),exports['restartQuota']=exports[a8_0x4136ca(0xf8)]=exports[a8_0x4136ca(0xbc)]=exports[a8_0x4136ca(0xbd)]=exports['register']=exports[a8_0x4136ca(0xb9)]=void 0x0;const express_validator_1=require('express-validator'),Quota_1=require(a8_0x4136ca(0xcc)),Source_1=require(a8_0x4136ca(0xbf)),Server_1=require(a8_0x4136ca(0xbb)),getQuotas=(_0x24bd79,_0x50a772)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x5a2b12=a8_0x4136ca;let _0x5275f6=yield Quota_1[_0x5a2b12(0xf3)][_0x5a2b12(0xf6)]()['then'](_0xc701a0=>{return _0xc701a0;})[_0x5a2b12(0xd0)](_0x4b3c1b=>{const _0x47829e=_0x5a2b12;return{'errors':[{'location':'getServers','msg':_0x47829e(0xb4),'param':_0x47829e(0xbe)}]};});return _0x5275f6['sort']((_0x384ee0,_0x5bad5a)=>_0x5bad5a[_0x5a2b12(0xd1)]-_0x384ee0[_0x5a2b12(0xd1)]),_0x50a772[_0x5a2b12(0xe9)](_0x5275f6);});exports[a8_0x4136ca(0xb9)]=getQuotas;function a8_0x482d(_0x9785c9,_0x52800a){const _0x130d9a=a8_0x130d();return a8_0x482d=function(_0x482dec,_0x1614ee){_0x482dec=_0x482dec-0xb0;let _0x4cd0ee=_0x130d9a[_0x482dec];return _0x4cd0ee;},a8_0x482d(_0x9785c9,_0x52800a);}const register=(_0x5d7a4b,_0x2664fa)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x465658=a8_0x4136ca;yield express_validator_1['check'](_0x465658(0xfa))[_0x465658(0x106)]()[_0x465658(0xe0)]('limit_empty')['run'](_0x5d7a4b),yield express_validator_1[_0x465658(0xf4)](_0x465658(0xcf))[_0x465658(0x106)]()[_0x465658(0xe0)](_0x465658(0xd6))[_0x465658(0x101)](_0x5d7a4b);const _0x1bae0b=_0x515980=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0xd3e4f9=_0x465658;return yield Quota_1[_0xd3e4f9(0xf3)][_0xd3e4f9(0xfb)]({'limit':_0x5d7a4b[_0xd3e4f9(0xc5)]['limit'],'type':_0x5d7a4b[_0xd3e4f9(0xc5)][_0xd3e4f9(0xcf)]})[_0xd3e4f9(0xc4)](_0x359323=>{const _0x4b7a95=_0xd3e4f9;if(_0x359323)return Promise[_0x4b7a95(0xce)]('Lo\x20sentimos\x20esta\x20cuota\x20ya\x20se\x20encuentra\x20registrada');});});yield express_validator_1[_0x465658(0xf4)]('host')[_0x465658(0xe4)](_0x1bae0b)[_0x465658(0x101)](_0x5d7a4b);const _0x5352ab=express_validator_1[_0x465658(0xe8)](_0x5d7a4b);if(!_0x5352ab[_0x465658(0xfc)]())return _0x2664fa[_0x465658(0xe9)]({'errors':_0x5352ab[_0x465658(0xc6)]()});let _0x4456d8=new Quota_1['QuotaInterface']({'limit':_0x5d7a4b[_0x465658(0xc5)]['limit'],'type':_0x5d7a4b[_0x465658(0xc5)][_0x465658(0xcf)],'isdefault':![]});return yield Quota_1['Quota'][_0x465658(0xf5)](_0x4456d8,(_0x2c0e6c,_0x452971)=>{const _0x154e21=_0x465658;if(_0x2c0e6c)return _0x2664fa[_0x154e21(0xe9)]({'errors':[{'location':'register','msg':_0x154e21(0xc7)}]});else return _0x2664fa[_0x154e21(0xe9)](_0x452971);});});exports[a8_0x4136ca(0xd3)]=register;const linkSource=(_0x3074f0,_0x1ddcba)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x4bbbf3=a8_0x4136ca;Server_1['Server']['findOne']({'host':_0x3074f0[_0x4bbbf3(0xc5)][_0x4bbbf3(0x100)]})[_0x4bbbf3(0xcb)](_0x4bbbf3(0xb1))[_0x4bbbf3(0xc4)](_0x480cd4=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x1636d9=_0x4bbbf3;let _0x390e1a=_0x480cd4[_0x1636d9(0xb1)][_0x1636d9(0xd8)](function(_0x250b30){const _0x476193=_0x1636d9;return _0x250b30[_0x476193(0x107)]==_0x3074f0[_0x476193(0xc5)][_0x476193(0x107)];})[0x0];if(_0x3074f0[_0x1636d9(0xc5)][_0x1636d9(0xc9)]=='noquota'){if(_0x390e1a[_0x1636d9(0xe6)]!==undefined){yield _0x390e1a[_0x1636d9(0xcb)](_0x1636d9(0xe6))['execPopulate']();let _0x3263d9=yield _0x390e1a[_0x1636d9(0xe6)]['populate']('sources')['execPopulate'](),_0x87eb96=_0x3263d9['sources'][_0x1636d9(0xd8)](function(_0x237709){const _0x560605=_0x1636d9;return _0x237709['identifier']!=_0x3074f0[_0x560605(0xc5)][_0x560605(0x107)];});return _0x3263d9['sources']=_0x87eb96,_0x3263d9[_0x1636d9(0xeb)](),yield Source_1['Source'][_0x1636d9(0xc1)][_0x1636d9(0x104)]({'_id':_0x390e1a[_0x1636d9(0xb8)]},{'$unset':{'quota':0x1}}),_0x1ddcba['json']({'status':_0x1636d9(0xc8),'msg':_0x1636d9(0x108)});}else return _0x1ddcba[_0x1636d9(0xe9)]({'status':_0x1636d9(0xb5),'msg':_0x1636d9(0xd2)});}else yield Quota_1[_0x1636d9(0xf3)][_0x1636d9(0xfb)]({'_id':_0x3074f0[_0x1636d9(0xc5)][_0x1636d9(0xc9)]})[_0x1636d9(0xcb)](_0x1636d9(0xb1))[_0x1636d9(0xc4)](_0x3861fb=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x35a1a4=_0x1636d9;let _0x3ebd19=_0x3861fb[_0x35a1a4(0xb1)][_0x35a1a4(0xd8)](function(_0x4f500b){const _0x192546=_0x35a1a4;return _0x4f500b[_0x192546(0x107)]==_0x3074f0[_0x192546(0xc5)][_0x192546(0x107)];});if(_0x3ebd19['length']>0x0)return _0x1ddcba[_0x35a1a4(0xe9)]({'errors':[{'location':_0x35a1a4(0xea),'msg':'Esta\x20cuota\x20ya\x20estÃ¡\x20establecidad\x20para\x20'+_0x390e1a[_0x35a1a4(0x107)]}]});else{if(_0x390e1a[_0x35a1a4(0xe6)]){yield _0x390e1a[_0x35a1a4(0xcb)](_0x35a1a4(0xe6))[_0x35a1a4(0xfe)]();let _0x1a7fde=yield _0x390e1a[_0x35a1a4(0xe6)]['populate'](_0x35a1a4(0xb1))[_0x35a1a4(0xfe)](),_0x3caf99=_0x1a7fde[_0x35a1a4(0xb1)]['filter'](function(_0x4d1a6b){const _0x3f18c4=_0x35a1a4;return _0x4d1a6b[_0x3f18c4(0x107)]!=_0x3074f0[_0x3f18c4(0xc5)]['identifier'];});_0x1a7fde[_0x35a1a4(0xb1)]=_0x3caf99,_0x1a7fde[_0x35a1a4(0xeb)]();}return _0x390e1a[_0x35a1a4(0xe6)]=_0x3861fb[_0x35a1a4(0xb8)],_0x390e1a['save'](),_0x3861fb['sources'][_0x35a1a4(0xcd)](_0x390e1a),_0x3861fb[_0x35a1a4(0xeb)](),_0x1ddcba['json']({'status':'ok','msg':_0x35a1a4(0xd9)});}}))[_0x1636d9(0xd0)](_0x33eb10=>{const _0x3a6134=_0x1636d9;return _0x1ddcba[_0x3a6134(0xe9)]({'errors':[{'location':_0x3a6134(0xea),'msg':_0x3a6134(0xc0),'param':'connection'}]});});}))[_0x4bbbf3(0xd0)](_0x2766ce=>{const _0x5851c5=_0x4bbbf3;return _0x1ddcba[_0x5851c5(0xe9)]({'errors':[{'location':'update','msg':_0x5851c5(0x103),'param':_0x5851c5(0xec)}]});});});exports[a8_0x4136ca(0xbd)]=linkSource;const deleteQuota=(_0x5cccb6,_0x6dc9a4)=>{const _0x24f0f3=a8_0x4136ca;Quota_1[_0x24f0f3(0xf3)][_0x24f0f3(0xd4)](_0x5cccb6[_0x24f0f3(0xda)]['id'])[_0x24f0f3(0xcb)]('sources')[_0x24f0f3(0xc4)](_0x4f3824=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x558117=_0x24f0f3;if(_0x4f3824)_0x4f3824[_0x558117(0xb1)][_0x558117(0xdf)]((_0x5e689f,_0x7cd030)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x118bb2=_0x558117;yield Source_1[_0x118bb2(0xe5)][_0x118bb2(0xc1)][_0x118bb2(0x104)]({'_id':_0x5e689f[_0x118bb2(0xb8)]},{'$unset':{'quota':0x1}});})),Quota_1['Quota'][_0x558117(0xb0)](_0x5cccb6[_0x558117(0xda)]['id'])['then'](()=>{const _0x358fe6=_0x558117;return _0x6dc9a4[_0x358fe6(0xe9)](_0x4f3824);})['catch'](_0x3f5da4=>{const _0xa92e57=_0x558117;return _0x6dc9a4[_0xa92e57(0xe9)]({'errors':[{'location':_0xa92e57(0xea),'msg':_0xa92e57(0x102),'param':_0xa92e57(0xec)}]});});else return _0x6dc9a4[_0x558117(0xe9)]({'errors':[{'location':_0x558117(0xb7),'msg':'Lo\x20sentimos\x20esta\x20cuota\x20no\x20se\x20encuentra\x20registrada','param':'host'}]});}))[_0x24f0f3(0xd0)](_0x3b643b=>{const _0x39f0f1=_0x24f0f3;return _0x6dc9a4['json']({'errors':[{'location':_0x39f0f1(0xb7),'msg':'Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20de\x20la\x20cuota','param':_0x39f0f1(0xed)}]});});};exports[a8_0x4136ca(0xbc)]=deleteQuota;const setDefault=(_0x5e5aa7,_0x315e0c)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x4600ef=a8_0x4136ca;let _0x3d0884='';yield Quota_1[_0x4600ef(0xf3)]['findOne']({'isdefault':!![]})[_0x4600ef(0xc4)](_0x54b14c=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x127414=_0x4600ef;if(_0x54b14c){if(_0x54b14c[_0x127414(0xb8)]==_0x5e5aa7[_0x127414(0xda)]['id'])_0x3d0884=_0x127414(0xb3);else yield Quota_1[_0x127414(0xf3)]['findByIdAndUpdate'](_0x54b14c[_0x127414(0xb8)],{'isdefault':![]},{'new':!![]}),_0x3d0884=_0x127414(0xe2);}}))[_0x4600ef(0xd0)](_0xc8ddf1=>{const _0x514e9c=_0x4600ef;return _0x315e0c[_0x514e9c(0xe9)]({'errors':[{'location':_0x514e9c(0xea),'msg':_0x514e9c(0xc0)}]});});if(_0x3d0884==_0x4600ef(0xb3))return _0x315e0c['json']({'errors':[{'location':'update','msg':_0x4600ef(0xe7)}]});else{if(_0x5e5aa7[_0x4600ef(0xc5)][_0x4600ef(0xc9)]!=_0x4600ef(0xef))yield Quota_1[_0x4600ef(0xf3)][_0x4600ef(0xd4)](_0x5e5aa7['params']['id'])['then'](_0x4301a6=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0xd36e09=_0x4600ef;if(_0x4301a6)yield Quota_1[_0xd36e09(0xf3)][_0xd36e09(0xe3)](_0x5e5aa7['params']['id'],{'isdefault':!![]},{'new':!![]})[_0xd36e09(0xc4)](_0x431b8c=>{const _0x3d3c8e=_0xd36e09;return _0x315e0c[_0x3d3c8e(0xe9)]({'status':_0x3d3c8e(0xc2),'msg':_0x3d3c8e(0xf2)});})[_0xd36e09(0xd0)](_0x51b8ea=>{const _0xe7f4df=_0xd36e09;return _0x315e0c[_0xe7f4df(0xe9)]({'errors':[{'location':'update','msg':_0xe7f4df(0xf1),'param':_0xe7f4df(0xec)}]});});else return _0x315e0c[_0xd36e09(0xe9)]({'errors':[{'location':_0xd36e09(0xb7),'msg':_0xd36e09(0xf9),'param':'host'}]});}))[_0x4600ef(0xd0)](_0x353a3e=>{const _0x21e460=_0x4600ef;return _0x315e0c[_0x21e460(0xe9)]({'errors':[{'location':_0x21e460(0xb7),'msg':_0x21e460(0xc0),'param':_0x21e460(0xed)}]});});else{if(_0x3d0884=='deleted')return _0x315e0c[_0x4600ef(0xe9)]({'status':'deletedquota','msg':_0x4600ef(0xe1)});else return _0x315e0c['json']({'status':'nothingtodo','msg':_0x4600ef(0xd2)});}}});exports['setDefault']=setDefault;function a8_0x130d(){const _0x1da2d3=['next','Lo\x20sentimos\x20no\x20se\x20pudo\x20actualizar\x20la\x20cuota','Cuota\x20establecida\x20por\x20defecto\x20correctamente','Quota','check','create','find','6TSocuu','setDefault','Lo\x20sentimos\x20esta\x20cuota\x20no\x20se\x20encuentra\x20registrada','limit','findOne','isEmpty','throw','execPopulate','1738911vFRLly','host','run','Lo\x20sentimos\x20no\x20se\x20pudo\x20eliminar\x20la\x20cuota','Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20del\x20servidor','updateOne','done','notEmpty','identifier','Cuota\x20eliminada\x20correctamente','findByIdAndDelete','sources','value','self','Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20de\x20las\x20cuotas','nothingtodo','restartQuota','delete','_id','getQuotas','1322408nFllvd','../models/Server','deleteQuota','linkSource','servers','../models/Source','Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20de\x20la\x20cuota','collection','updatedquota','2307655sQNvxl','then','body','array','Lo\x20sentimos\x20no\x20se\x20pudo\x20registrar\x20la\x20cuota','quotadeleted','quotaid','27ItsgGG','populate','../models/Quota','push','reject','type','catch','isdefault','Nada\x20que\x20hacer\x20con\x20la\x20cuota','register','findById','585375xGpsEg','type_empty','1752700KMxtOR','filter','Cuota\x20establecida\x20correctamente','params','88NIvsOE','54500wLiayq','defineProperty','2213869fKsmdn','map','withMessage','Cuota\x20eliminada\x20de\x20por\x20defecto\x20correctamente','deleted','findByIdAndUpdate','custom','Source','quota','Esta\x20cuota\x20ya\x20es\x20la\x20cuota\x20por\x20defecto','validationResult','json','update','save','connection','findserver','2HZuNAr','nodefault'];a8_0x130d=function(){return _0x1da2d3;};return a8_0x130d();}const restartQuota=_0x365cdc=>{const _0x4a9fa3=a8_0x4136ca;Quota_1[_0x4a9fa3(0xf3)][_0x4a9fa3(0xf6)]({'type':_0x365cdc})[_0x4a9fa3(0xcb)](_0x4a9fa3(0xb1))[_0x4a9fa3(0xc4)](_0x146006=>{const _0x542e1c=_0x4a9fa3;_0x146006[_0x542e1c(0xdf)]((_0x15e642,_0x5f251b)=>{const _0x12736a=_0x542e1c;_0x15e642[_0x12736a(0xb1)]['map']((_0x352eb8,_0x31e981)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x571ba3=_0x12736a;yield Source_1[_0x571ba3(0xe5)][_0x571ba3(0xe3)]({'_id':_0x352eb8['_id']},{'quota_consumed':0x0});}));});});};exports[a8_0x4136ca(0xb6)]=restartQuota;