'use strict';const a81_0x2871a1=a81_0xbcd8;(function(_0x514658,_0x37202a){const _0x45136d=a81_0xbcd8,_0x38cca2=_0x514658();while(!![]){try{const _0x55caa1=-parseInt(_0x45136d(0x238))/0x1+parseInt(_0x45136d(0x21d))/0x2*(-parseInt(_0x45136d(0x21e))/0x3)+parseInt(_0x45136d(0x211))/0x4+parseInt(_0x45136d(0x1e9))/0x5*(parseInt(_0x45136d(0x1fb))/0x6)+parseInt(_0x45136d(0x200))/0x7*(-parseInt(_0x45136d(0x224))/0x8)+-parseInt(_0x45136d(0x214))/0x9+parseInt(_0x45136d(0x1ee))/0xa;if(_0x55caa1===_0x37202a)break;else _0x38cca2['push'](_0x38cca2['shift']());}catch(_0x138b0e){_0x38cca2['push'](_0x38cca2['shift']());}}}(a81_0x1d9c,0x3bb66));var __awaiter=this&&this[a81_0x2871a1(0x229)]||function(_0x2e9744,_0x69b45a,_0x147235,_0x115c34){function _0x4ecdd1(_0x5043cc){return _0x5043cc instanceof _0x147235?_0x5043cc:new _0x147235(function(_0x301b89){_0x301b89(_0x5043cc);});}return new(_0x147235||(_0x147235=Promise))(function(_0x3a3bc5,_0x5b3445){const _0x1823ca=a81_0xbcd8;function _0x1aae06(_0x5ec034){const _0x243c45=a81_0xbcd8;try{_0x4438b4(_0x115c34[_0x243c45(0x20a)](_0x5ec034));}catch(_0x191094){_0x5b3445(_0x191094);}}function _0x41b7aa(_0x29b5a2){const _0x4f65c1=a81_0xbcd8;try{_0x4438b4(_0x115c34[_0x4f65c1(0x233)](_0x29b5a2));}catch(_0x459387){_0x5b3445(_0x459387);}}function _0x4438b4(_0x24ec47){const _0x144b41=a81_0xbcd8;_0x24ec47[_0x144b41(0x234)]?_0x3a3bc5(_0x24ec47[_0x144b41(0x22f)]):_0x4ecdd1(_0x24ec47[_0x144b41(0x22f)])[_0x144b41(0x207)](_0x1aae06,_0x41b7aa);}_0x4438b4((_0x115c34=_0x115c34['apply'](_0x2e9744,_0x69b45a||[]))[_0x1823ca(0x20a)]());});};Object[a81_0x2871a1(0x213)](exports,a81_0x2871a1(0x1f7),{'value':!![]}),exports[a81_0x2871a1(0x230)]=exports[a81_0x2871a1(0x21b)]=exports['deleteQuota']=exports[a81_0x2871a1(0x21f)]=exports[a81_0x2871a1(0x1f4)]=exports[a81_0x2871a1(0x1ef)]=void 0x0;const express_validator_1=require(a81_0x2871a1(0x1f5)),Quota_1=require(a81_0x2871a1(0x227)),Source_1=require(a81_0x2871a1(0x1e5)),Server_1=require(a81_0x2871a1(0x20c)),getQuotas=(_0x254fda,_0x1d0b4f)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x5d2720=a81_0x2871a1;let _0x5dd924=yield Quota_1[_0x5d2720(0x22b)][_0x5d2720(0x206)]()[_0x5d2720(0x207)](_0x32765b=>{return _0x32765b;})['catch'](_0x5bde0f=>{const _0x230c8c=_0x5d2720;return{'errors':[{'location':_0x230c8c(0x204),'msg':_0x230c8c(0x202),'param':_0x230c8c(0x223)}]};});return _0x5dd924[_0x5d2720(0x225)]((_0x156dbf,_0x2e0034)=>_0x2e0034[_0x5d2720(0x235)]-_0x156dbf[_0x5d2720(0x235)]),_0x1d0b4f['json'](_0x5dd924);});exports[a81_0x2871a1(0x1ef)]=getQuotas;const register=(_0x7f64cb,_0x102bd0)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x1bef2f=a81_0x2871a1;yield express_validator_1['check'](_0x1bef2f(0x228))['notEmpty']()[_0x1bef2f(0x20d)](_0x1bef2f(0x209))[_0x1bef2f(0x23b)](_0x7f64cb),yield express_validator_1[_0x1bef2f(0x1fe)](_0x1bef2f(0x1f6))['notEmpty']()[_0x1bef2f(0x20d)](_0x1bef2f(0x1f1))[_0x1bef2f(0x23b)](_0x7f64cb);const _0x3bc5c9=_0x423fb7=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x512f59=_0x1bef2f;return yield Quota_1[_0x512f59(0x22b)]['findOne']({'limit':_0x7f64cb[_0x512f59(0x231)][_0x512f59(0x228)],'type':_0x7f64cb['body']['type']})[_0x512f59(0x207)](_0x341ff1=>{const _0x19a655=_0x512f59;if(_0x341ff1)return Promise[_0x19a655(0x20e)]('Lo\x20sentimos\x20esta\x20cuota\x20ya\x20se\x20encuentra\x20registrada');});});yield express_validator_1[_0x1bef2f(0x1fe)]('host')['custom'](_0x3bc5c9)[_0x1bef2f(0x23b)](_0x7f64cb);const _0x4f1d02=express_validator_1[_0x1bef2f(0x205)](_0x7f64cb);if(!_0x4f1d02[_0x1bef2f(0x22e)]())return _0x102bd0['json']({'errors':_0x4f1d02['array']()});let _0x4f23cd=new Quota_1[(_0x1bef2f(0x1fa))]({'limit':_0x7f64cb['body'][_0x1bef2f(0x228)],'type':_0x7f64cb[_0x1bef2f(0x231)][_0x1bef2f(0x1f6)],'isdefault':![]});return yield Quota_1[_0x1bef2f(0x22b)]['create'](_0x4f23cd,(_0x5c2f87,_0x273d4e)=>{const _0x149b73=_0x1bef2f;if(_0x5c2f87)return _0x102bd0[_0x149b73(0x221)]({'errors':[{'location':_0x149b73(0x1f4),'msg':'Lo\x20sentimos\x20no\x20se\x20pudo\x20registrar\x20la\x20cuota'}]});else return _0x102bd0[_0x149b73(0x221)](_0x273d4e);});});exports[a81_0x2871a1(0x1f4)]=register;const linkSource=(_0x1a7c71,_0x3a47cd)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x436571=a81_0x2871a1;Server_1[_0x436571(0x21c)][_0x436571(0x220)]({'host':_0x1a7c71[_0x436571(0x231)][_0x436571(0x1ec)]})['populate'](_0x436571(0x236))[_0x436571(0x207)](_0x1ad9bd=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x386340=_0x436571;let _0x9fb688=_0x1ad9bd['sources']['filter'](function(_0x24ef7e){const _0x41fad3=a81_0xbcd8;return _0x24ef7e[_0x41fad3(0x1f9)]==_0x1a7c71['body']['identifier'];})[0x0];if(_0x1a7c71[_0x386340(0x231)][_0x386340(0x201)]=='noquota'){if(_0x9fb688[_0x386340(0x1e6)]!==undefined){yield _0x9fb688['populate'](_0x386340(0x1e6))['execPopulate']();let _0x4a432c=yield _0x9fb688[_0x386340(0x1e6)][_0x386340(0x1fd)](_0x386340(0x236))['execPopulate'](),_0x29c406=_0x4a432c[_0x386340(0x236)][_0x386340(0x215)](function(_0x5d5d08){const _0x23e35b=_0x386340;return _0x5d5d08['identifier']!=_0x1a7c71[_0x23e35b(0x231)][_0x23e35b(0x1f9)];});return _0x4a432c['sources']=_0x29c406,_0x4a432c[_0x386340(0x222)](),yield Source_1['Source'][_0x386340(0x20f)]['updateOne']({'_id':_0x9fb688[_0x386340(0x218)]},{'$unset':{'quota':0x1}}),_0x3a47cd[_0x386340(0x221)]({'status':_0x386340(0x203),'msg':_0x386340(0x1e7)});}else return _0x3a47cd['json']({'status':_0x386340(0x22d),'msg':_0x386340(0x22c)});}else yield Quota_1['Quota']['findOne']({'_id':_0x1a7c71[_0x386340(0x231)][_0x386340(0x201)]})[_0x386340(0x1fd)](_0x386340(0x236))[_0x386340(0x207)](_0x47d41f=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x3e095e=_0x386340;let _0x5db5aa=_0x47d41f[_0x3e095e(0x236)][_0x3e095e(0x215)](function(_0x48b222){const _0x93a944=_0x3e095e;return _0x48b222[_0x93a944(0x1f9)]==_0x1a7c71[_0x93a944(0x231)][_0x93a944(0x1f9)];});if(_0x5db5aa['length']>0x0)return _0x3a47cd[_0x3e095e(0x221)]({'errors':[{'location':_0x3e095e(0x208),'msg':'Esta\x20cuota\x20ya\x20estÃ¡\x20establecidad\x20para\x20'+_0x9fb688[_0x3e095e(0x1f9)]}]});else{if(_0x9fb688[_0x3e095e(0x1e6)]){yield _0x9fb688['populate']('quota')[_0x3e095e(0x1fc)]();let _0x12c41f=yield _0x9fb688[_0x3e095e(0x1e6)]['populate']('sources')[_0x3e095e(0x1fc)](),_0x5e643c=_0x12c41f['sources']['filter'](function(_0x3afdcd){const _0x3a6bb7=_0x3e095e;return _0x3afdcd[_0x3a6bb7(0x1f9)]!=_0x1a7c71[_0x3a6bb7(0x231)][_0x3a6bb7(0x1f9)];});_0x12c41f[_0x3e095e(0x236)]=_0x5e643c,_0x12c41f[_0x3e095e(0x222)]();}return _0x9fb688[_0x3e095e(0x1e6)]=_0x47d41f['_id'],_0x9fb688[_0x3e095e(0x222)](),_0x47d41f[_0x3e095e(0x236)][_0x3e095e(0x216)](_0x9fb688),_0x47d41f[_0x3e095e(0x222)](),_0x3a47cd['json']({'status':'ok','msg':'Cuota\x20establecida\x20correctamente'});}}))['catch'](_0xe221b7=>{const _0x362786=_0x386340;return _0x3a47cd['json']({'errors':[{'location':_0x362786(0x208),'msg':_0x362786(0x20b),'param':'connection'}]});});}))[_0x436571(0x1ff)](_0x5d10cf=>{const _0x4758d8=_0x436571;return _0x3a47cd['json']({'errors':[{'location':'update','msg':_0x4758d8(0x1f2),'param':'connection'}]});});});exports[a81_0x2871a1(0x21f)]=linkSource;const deleteQuota=(_0x5702cc,_0x250163)=>{const _0x292ad9=a81_0x2871a1;Quota_1[_0x292ad9(0x22b)]['findById'](_0x5702cc[_0x292ad9(0x21a)]['id'])[_0x292ad9(0x1fd)](_0x292ad9(0x236))[_0x292ad9(0x207)](_0x157ebd=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x4f1369=_0x292ad9;if(_0x157ebd)_0x157ebd[_0x4f1369(0x236)][_0x4f1369(0x23a)]((_0x5645d2,_0x5b3f12)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x2a1441=_0x4f1369;yield Source_1[_0x2a1441(0x1f0)][_0x2a1441(0x20f)][_0x2a1441(0x212)]({'_id':_0x5645d2[_0x2a1441(0x218)]},{'$unset':{'quota':0x1}});})),Quota_1['Quota']['findByIdAndDelete'](_0x5702cc[_0x4f1369(0x21a)]['id'])[_0x4f1369(0x207)](()=>{return _0x250163['json'](_0x157ebd);})['catch'](_0x28bd52=>{const _0x26c365=_0x4f1369;return _0x250163[_0x26c365(0x221)]({'errors':[{'location':_0x26c365(0x208),'msg':_0x26c365(0x239),'param':_0x26c365(0x22a)}]});});else return _0x250163[_0x4f1369(0x221)]({'errors':[{'location':'delete','msg':_0x4f1369(0x232),'param':'host'}]});}))[_0x292ad9(0x1ff)](_0x467222=>{const _0x17385e=_0x292ad9;return _0x250163['json']({'errors':[{'location':_0x17385e(0x1ea),'msg':_0x17385e(0x20b),'param':_0x17385e(0x219)}]});});};function a81_0xbcd8(_0x345abe,_0x35203e){const _0x1d9c88=a81_0x1d9c();return a81_0xbcd8=function(_0xbcd889,_0x18b389){_0xbcd889=_0xbcd889-0x1e5;let _0x2287d5=_0x1d9c88[_0xbcd889];return _0x2287d5;},a81_0xbcd8(_0x345abe,_0x35203e);}exports[a81_0x2871a1(0x226)]=deleteQuota;const setDefault=(_0x5b2063,_0x4fd66e)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x2c0d84=a81_0x2871a1;let _0x51a55a='';yield Quota_1[_0x2c0d84(0x22b)][_0x2c0d84(0x220)]({'isdefault':!![]})[_0x2c0d84(0x207)](_0x554539=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x25d32d=_0x2c0d84;if(_0x554539){if(_0x554539[_0x25d32d(0x218)]==_0x5b2063['params']['id'])_0x51a55a='self';else yield Quota_1[_0x25d32d(0x22b)]['findByIdAndUpdate'](_0x554539[_0x25d32d(0x218)],{'isdefault':![]},{'new':!![]}),_0x51a55a=_0x25d32d(0x237);}}))[_0x2c0d84(0x1ff)](_0x511fdd=>{const _0x36b892=_0x2c0d84;return _0x4fd66e[_0x36b892(0x221)]({'errors':[{'location':_0x36b892(0x208),'msg':_0x36b892(0x20b)}]});});if(_0x51a55a==_0x2c0d84(0x1e8))return _0x4fd66e[_0x2c0d84(0x221)]({'errors':[{'location':_0x2c0d84(0x208),'msg':_0x2c0d84(0x1f8)}]});else{if(_0x5b2063[_0x2c0d84(0x231)][_0x2c0d84(0x201)]!='nodefault')yield Quota_1[_0x2c0d84(0x22b)][_0x2c0d84(0x210)](_0x5b2063[_0x2c0d84(0x21a)]['id'])['then'](_0x221cca=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x5d3be1=_0x2c0d84;if(_0x221cca)yield Quota_1[_0x5d3be1(0x22b)]['findByIdAndUpdate'](_0x5b2063['params']['id'],{'isdefault':!![]},{'new':!![]})['then'](_0x44d544=>{const _0x7457=_0x5d3be1;return _0x4fd66e[_0x7457(0x221)]({'status':'updatedquota','msg':_0x7457(0x217)});})[_0x5d3be1(0x1ff)](_0x553c71=>{const _0x3b952e=_0x5d3be1;return _0x4fd66e[_0x3b952e(0x221)]({'errors':[{'location':_0x3b952e(0x208),'msg':_0x3b952e(0x1eb),'param':_0x3b952e(0x22a)}]});});else return _0x4fd66e[_0x5d3be1(0x221)]({'errors':[{'location':'delete','msg':_0x5d3be1(0x232),'param':'host'}]});}))[_0x2c0d84(0x1ff)](_0x2b2011=>{const _0x3f805c=_0x2c0d84;return _0x4fd66e[_0x3f805c(0x221)]({'errors':[{'location':_0x3f805c(0x1ea),'msg':_0x3f805c(0x20b),'param':'findserver'}]});});else{if(_0x51a55a==_0x2c0d84(0x237))return _0x4fd66e['json']({'status':_0x2c0d84(0x1f3),'msg':'Cuota\x20eliminada\x20de\x20por\x20defecto\x20correctamente'});else return _0x4fd66e[_0x2c0d84(0x221)]({'status':_0x2c0d84(0x22d),'msg':'Nada\x20que\x20hacer\x20con\x20la\x20cuota'});}}});function a81_0x1d9c(){const _0x42a2bf=['body','Lo\x20sentimos\x20esta\x20cuota\x20no\x20se\x20encuentra\x20registrada','throw','done','isdefault','sources','deleted','69716QGXdEG','Lo\x20sentimos\x20no\x20se\x20pudo\x20eliminar\x20la\x20cuota','map','run','../models/Source','quota','Cuota\x20eliminada\x20correctamente','self','2392945xKOqQb','delete','Lo\x20sentimos\x20no\x20se\x20pudo\x20actualizar\x20la\x20cuota','host','findByIdAndUpdate','1396860akSJNT','getQuotas','Source','type_empty','Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20del\x20servidor','deletedquota','register','express-validator','type','__esModule','Esta\x20cuota\x20ya\x20es\x20la\x20cuota\x20por\x20defecto','identifier','QuotaInterface','6iMKIcc','execPopulate','populate','check','catch','595TGXhmi','quotaid','Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20de\x20las\x20cuotas','quotadeleted','getServers','validationResult','find','then','update','limit_empty','next','Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20de\x20la\x20cuota','../models/Server','withMessage','reject','collection','findById','1763092FHfNlC','updateOne','defineProperty','1854783wFSIWI','filter','push','Cuota\x20establecida\x20por\x20defecto\x20correctamente','_id','findserver','params','setDefault','Server','4666RAFhuN','498NPBVFk','linkSource','findOne','json','save','servers','14248gbsxSz','sort','deleteQuota','../models/Quota','limit','__awaiter','connection','Quota','Nada\x20que\x20hacer\x20con\x20la\x20cuota','nothingtodo','isEmpty','value','restartQuota'];a81_0x1d9c=function(){return _0x42a2bf;};return a81_0x1d9c();}exports[a81_0x2871a1(0x21b)]=setDefault;const restartQuota=_0x48eff2=>{const _0x2872bd=a81_0x2871a1;Quota_1[_0x2872bd(0x22b)][_0x2872bd(0x206)]({'type':_0x48eff2})['populate'](_0x2872bd(0x236))[_0x2872bd(0x207)](_0x1fd1aa=>{_0x1fd1aa['map']((_0x39d530,_0xd03d42)=>{const _0x538b12=a81_0xbcd8;_0x39d530[_0x538b12(0x236)]['map']((_0xd908a,_0x5355c3)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0xc85cc8=_0x538b12;yield Source_1[_0xc85cc8(0x1f0)][_0xc85cc8(0x1ed)]({'_id':_0xd908a[_0xc85cc8(0x218)]},{'quota_consumed':0x0});}));});});};exports[a81_0x2871a1(0x230)]=restartQuota;