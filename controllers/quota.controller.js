'use strict';const a8_0x3ea6a7=a8_0x52f7;(function(_0x1eb227,_0x827564){const _0x39febb=a8_0x52f7,_0x17469b=_0x1eb227();while(!![]){try{const _0x4e41b0=parseInt(_0x39febb(0x209))/0x1*(-parseInt(_0x39febb(0x23e))/0x2)+parseInt(_0x39febb(0x240))/0x3*(-parseInt(_0x39febb(0x214))/0x4)+-parseInt(_0x39febb(0x21f))/0x5+-parseInt(_0x39febb(0x235))/0x6+parseInt(_0x39febb(0x20c))/0x7+parseInt(_0x39febb(0x217))/0x8*(parseInt(_0x39febb(0x227))/0x9)+-parseInt(_0x39febb(0x1f2))/0xa*(-parseInt(_0x39febb(0x231))/0xb);if(_0x4e41b0===_0x827564)break;else _0x17469b['push'](_0x17469b['shift']());}catch(_0x25f717){_0x17469b['push'](_0x17469b['shift']());}}}(a8_0x10d7,0x8a01b));function a8_0x52f7(_0x595f16,_0x861d7d){const _0x10d77c=a8_0x10d7();return a8_0x52f7=function(_0x52f78f,_0x1e781a){_0x52f78f=_0x52f78f-0x1ef;let _0x3e81e5=_0x10d77c[_0x52f78f];return _0x3e81e5;},a8_0x52f7(_0x595f16,_0x861d7d);}var __awaiter=this&&this[a8_0x3ea6a7(0x246)]||function(_0x961eeb,_0x16bcb6,_0x58e3af,_0x11d2f8){function _0x576131(_0x34e01d){return _0x34e01d instanceof _0x58e3af?_0x34e01d:new _0x58e3af(function(_0x27e009){_0x27e009(_0x34e01d);});}return new(_0x58e3af||(_0x58e3af=Promise))(function(_0x38e15e,_0x3303cf){const _0x28467f=a8_0x52f7;function _0x543dc5(_0x4df482){const _0x71db2a=a8_0x52f7;try{_0x3e1863(_0x11d2f8[_0x71db2a(0x219)](_0x4df482));}catch(_0x517bc4){_0x3303cf(_0x517bc4);}}function _0x272181(_0xcf6e51){const _0x333155=a8_0x52f7;try{_0x3e1863(_0x11d2f8[_0x333155(0x206)](_0xcf6e51));}catch(_0x5c3af2){_0x3303cf(_0x5c3af2);}}function _0x3e1863(_0x2dc3a6){const _0x81a25a=a8_0x52f7;_0x2dc3a6['done']?_0x38e15e(_0x2dc3a6[_0x81a25a(0x22c)]):_0x576131(_0x2dc3a6['value'])[_0x81a25a(0x1f8)](_0x543dc5,_0x272181);}_0x3e1863((_0x11d2f8=_0x11d2f8[_0x28467f(0x215)](_0x961eeb,_0x16bcb6||[]))[_0x28467f(0x219)]());});};Object[a8_0x3ea6a7(0x1fb)](exports,'__esModule',{'value':!![]}),exports[a8_0x3ea6a7(0x23d)]=exports['setDefault']=exports[a8_0x3ea6a7(0x239)]=exports['linkSource']=exports[a8_0x3ea6a7(0x245)]=exports[a8_0x3ea6a7(0x230)]=void 0x0;const express_validator_1=require(a8_0x3ea6a7(0x1f3)),Quota_1=require(a8_0x3ea6a7(0x207)),Source_1=require('../models/Source'),Server_1=require('../models/Server'),getQuotas=(_0x508f01,_0x132f58)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0xd01dec=a8_0x3ea6a7;let _0x319822=yield Quota_1[_0xd01dec(0x1f0)][_0xd01dec(0x211)]()[_0xd01dec(0x1f8)](_0x428ac0=>{return _0x428ac0;})[_0xd01dec(0x210)](_0x11c0fd=>{const _0x4e5657=_0xd01dec;return{'errors':[{'location':_0x4e5657(0x22d),'msg':_0x4e5657(0x234),'param':_0x4e5657(0x225)}]};});return _0x319822['sort']((_0x20e0b2,_0x24331e)=>_0x24331e[_0xd01dec(0x232)]-_0x20e0b2[_0xd01dec(0x232)]),_0x132f58[_0xd01dec(0x205)](_0x319822);});exports[a8_0x3ea6a7(0x230)]=getQuotas;const register=(_0x414f66,_0x2caaa1)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x21a813=a8_0x3ea6a7;yield express_validator_1[_0x21a813(0x1f5)](_0x21a813(0x201))[_0x21a813(0x22e)]()['withMessage'](_0x21a813(0x21a))[_0x21a813(0x1fc)](_0x414f66),yield express_validator_1['check'](_0x21a813(0x241))[_0x21a813(0x22e)]()[_0x21a813(0x203)](_0x21a813(0x21b))['run'](_0x414f66);const _0x5a1efd=_0x5c9f25=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x2560f9=_0x21a813;return yield Quota_1['Quota'][_0x2560f9(0x223)]({'limit':_0x414f66['body']['limit'],'type':_0x414f66[_0x2560f9(0x237)]['type']})[_0x2560f9(0x1f8)](_0x229cb0=>{const _0x4c1840=_0x2560f9;if(_0x229cb0)return Promise[_0x4c1840(0x243)](_0x4c1840(0x1ef));});});yield express_validator_1[_0x21a813(0x1f5)](_0x21a813(0x221))[_0x21a813(0x200)](_0x5a1efd)['run'](_0x414f66);const _0x3f25c2=express_validator_1[_0x21a813(0x20b)](_0x414f66);if(!_0x3f25c2[_0x21a813(0x20e)]())return _0x2caaa1[_0x21a813(0x205)]({'errors':_0x3f25c2['array']()});let _0x5a0882=new Quota_1[(_0x21a813(0x226))]({'limit':_0x414f66[_0x21a813(0x237)][_0x21a813(0x201)],'type':_0x414f66['body'][_0x21a813(0x241)],'isdefault':![]});return yield Quota_1['Quota'][_0x21a813(0x208)](_0x5a0882,(_0x42bc83,_0x390717)=>{const _0x45f320=_0x21a813;if(_0x42bc83)return _0x2caaa1[_0x45f320(0x205)]({'errors':[{'location':'register','msg':_0x45f320(0x1f7)}]});else return _0x2caaa1[_0x45f320(0x205)](_0x390717);});});exports[a8_0x3ea6a7(0x245)]=register;const linkSource=(_0x1135a6,_0x2cf0fe)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x170b23=a8_0x3ea6a7;Server_1[_0x170b23(0x1fa)][_0x170b23(0x223)]({'host':_0x1135a6['body'][_0x170b23(0x221)]})['populate'](_0x170b23(0x224))[_0x170b23(0x1f8)](_0x3a5009=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x3c6ba1=_0x170b23;let _0x188944=_0x3a5009[_0x3c6ba1(0x224)][_0x3c6ba1(0x213)](function(_0x3e017a){const _0x5a141f=_0x3c6ba1;return _0x3e017a['identifier']==_0x1135a6[_0x5a141f(0x237)][_0x5a141f(0x222)];})[0x0];if(_0x1135a6[_0x3c6ba1(0x237)][_0x3c6ba1(0x244)]==_0x3c6ba1(0x22a)){if(_0x188944['quota']!==undefined){yield _0x188944['populate'](_0x3c6ba1(0x212))['execPopulate']();let _0x12528d=yield _0x188944[_0x3c6ba1(0x212)][_0x3c6ba1(0x236)]('sources')[_0x3c6ba1(0x23b)](),_0x5cfb2b=_0x12528d['sources'][_0x3c6ba1(0x213)](function(_0x499a8e){const _0x512dfb=_0x3c6ba1;return _0x499a8e['identifier']!=_0x1135a6['body'][_0x512dfb(0x222)];});return _0x12528d[_0x3c6ba1(0x224)]=_0x5cfb2b,_0x12528d[_0x3c6ba1(0x20d)](),yield Source_1['Source']['collection'][_0x3c6ba1(0x1f4)]({'_id':_0x188944[_0x3c6ba1(0x1fd)]},{'$unset':{'quota':0x1}}),_0x2cf0fe[_0x3c6ba1(0x205)]({'status':'quotadeleted','msg':'Cuota\x20eliminada\x20correctamente'});}else return _0x2cf0fe[_0x3c6ba1(0x205)]({'status':_0x3c6ba1(0x23c),'msg':'Nada\x20que\x20hacer\x20con\x20la\x20cuota'});}else yield Quota_1['Quota'][_0x3c6ba1(0x223)]({'_id':_0x1135a6['body']['quotaid']})[_0x3c6ba1(0x236)](_0x3c6ba1(0x224))['then'](_0x3d9344=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x4e7b49=_0x3c6ba1;let _0x2d8cdb=_0x3d9344[_0x4e7b49(0x224)][_0x4e7b49(0x213)](function(_0x12e700){const _0x247908=_0x4e7b49;return _0x12e700[_0x247908(0x222)]==_0x1135a6[_0x247908(0x237)]['identifier'];});if(_0x2d8cdb[_0x4e7b49(0x1f6)]>0x0)return _0x2cf0fe[_0x4e7b49(0x205)]({'errors':[{'location':_0x4e7b49(0x248),'msg':_0x4e7b49(0x1fe)+_0x188944['identifier']}]});else{if(_0x188944['quota']){yield _0x188944[_0x4e7b49(0x236)](_0x4e7b49(0x212))[_0x4e7b49(0x23b)]();let _0x2fd5ab=yield _0x188944[_0x4e7b49(0x212)][_0x4e7b49(0x236)](_0x4e7b49(0x224))[_0x4e7b49(0x23b)](),_0x38314e=_0x2fd5ab[_0x4e7b49(0x224)][_0x4e7b49(0x213)](function(_0x4b3b04){const _0x346bc1=_0x4e7b49;return _0x4b3b04[_0x346bc1(0x222)]!=_0x1135a6[_0x346bc1(0x237)][_0x346bc1(0x222)];});_0x2fd5ab[_0x4e7b49(0x224)]=_0x38314e,_0x2fd5ab['save']();}return _0x188944[_0x4e7b49(0x212)]=_0x3d9344[_0x4e7b49(0x1fd)],_0x188944[_0x4e7b49(0x20d)](),_0x3d9344[_0x4e7b49(0x224)][_0x4e7b49(0x23a)](_0x188944),_0x3d9344[_0x4e7b49(0x20d)](),_0x2cf0fe['json']({'status':'ok','msg':_0x4e7b49(0x233)});}}))['catch'](_0x4e925c=>{const _0x1bc51b=_0x3c6ba1;return _0x2cf0fe[_0x1bc51b(0x205)]({'errors':[{'location':_0x1bc51b(0x248),'msg':_0x1bc51b(0x229),'param':_0x1bc51b(0x1f9)}]});});}))[_0x170b23(0x210)](_0x52400b=>{const _0x4aeabe=_0x170b23;return _0x2cf0fe[_0x4aeabe(0x205)]({'errors':[{'location':_0x4aeabe(0x248),'msg':_0x4aeabe(0x1f1),'param':_0x4aeabe(0x1f9)}]});});});exports['linkSource']=linkSource;const deleteQuota=(_0x4c75d0,_0x3df067)=>{const _0x5bf951=a8_0x3ea6a7;Quota_1[_0x5bf951(0x1f0)]['findById'](_0x4c75d0[_0x5bf951(0x218)]['id'])['populate'](_0x5bf951(0x224))[_0x5bf951(0x1f8)](_0x443337=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x37870a=_0x5bf951;if(_0x443337)_0x443337[_0x37870a(0x224)][_0x37870a(0x242)]((_0x57355c,_0x3ed482)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0xb13086=_0x37870a;yield Source_1[_0xb13086(0x20f)][_0xb13086(0x204)][_0xb13086(0x1f4)]({'_id':_0x57355c['_id']},{'$unset':{'quota':0x1}});})),Quota_1[_0x37870a(0x1f0)][_0x37870a(0x22f)](_0x4c75d0[_0x37870a(0x218)]['id'])[_0x37870a(0x1f8)](()=>{const _0x44d0eb=_0x37870a;return _0x3df067[_0x44d0eb(0x205)](_0x443337);})[_0x37870a(0x210)](_0x1fee4a=>{const _0x210b00=_0x37870a;return _0x3df067['json']({'errors':[{'location':_0x210b00(0x248),'msg':_0x210b00(0x20a),'param':_0x210b00(0x1f9)}]});});else return _0x3df067['json']({'errors':[{'location':_0x37870a(0x228),'msg':_0x37870a(0x216),'param':_0x37870a(0x221)}]});}))[_0x5bf951(0x210)](_0x3bb900=>{const _0x12c0fb=_0x5bf951;return _0x3df067[_0x12c0fb(0x205)]({'errors':[{'location':_0x12c0fb(0x228),'msg':_0x12c0fb(0x229),'param':'findserver'}]});});};exports[a8_0x3ea6a7(0x239)]=deleteQuota;const setDefault=(_0x28d0fb,_0x21154f)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x9e2f32=a8_0x3ea6a7;let _0x47ff08='';yield Quota_1['Quota']['findOne']({'isdefault':!![]})[_0x9e2f32(0x1f8)](_0x1989b8=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x446284=_0x9e2f32;if(_0x1989b8){if(_0x1989b8[_0x446284(0x1fd)]==_0x28d0fb[_0x446284(0x218)]['id'])_0x47ff08=_0x446284(0x21d);else yield Quota_1[_0x446284(0x1f0)][_0x446284(0x21c)](_0x1989b8[_0x446284(0x1fd)],{'isdefault':![]},{'new':!![]}),_0x47ff08=_0x446284(0x1ff);}}))['catch'](_0x4feea3=>{const _0x34daa6=_0x9e2f32;return _0x21154f['json']({'errors':[{'location':_0x34daa6(0x248),'msg':_0x34daa6(0x229)}]});});if(_0x47ff08==_0x9e2f32(0x21d))return _0x21154f['json']({'errors':[{'location':_0x9e2f32(0x248),'msg':_0x9e2f32(0x238)}]});else{if(_0x28d0fb[_0x9e2f32(0x237)][_0x9e2f32(0x244)]!=_0x9e2f32(0x22b))yield Quota_1[_0x9e2f32(0x1f0)][_0x9e2f32(0x220)](_0x28d0fb['params']['id'])[_0x9e2f32(0x1f8)](_0x2e367f=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x327086=_0x9e2f32;if(_0x2e367f)yield Quota_1[_0x327086(0x1f0)][_0x327086(0x21c)](_0x28d0fb[_0x327086(0x218)]['id'],{'isdefault':!![]},{'new':!![]})[_0x327086(0x1f8)](_0x2f194f=>{const _0x59b052=_0x327086;return _0x21154f[_0x59b052(0x205)]({'status':_0x59b052(0x202),'msg':'Cuota\x20establecida\x20por\x20defecto\x20correctamente'});})['catch'](_0xde046c=>{const _0x31728b=_0x327086;return _0x21154f[_0x31728b(0x205)]({'errors':[{'location':_0x31728b(0x248),'msg':'Lo\x20sentimos\x20no\x20se\x20pudo\x20actualizar\x20la\x20cuota','param':_0x31728b(0x1f9)}]});});else return _0x21154f['json']({'errors':[{'location':_0x327086(0x228),'msg':_0x327086(0x216),'param':_0x327086(0x221)}]});}))[_0x9e2f32(0x210)](_0x262a9d=>{const _0x12a5ca=_0x9e2f32;return _0x21154f[_0x12a5ca(0x205)]({'errors':[{'location':_0x12a5ca(0x228),'msg':_0x12a5ca(0x229),'param':_0x12a5ca(0x23f)}]});});else{if(_0x47ff08=='deleted')return _0x21154f[_0x9e2f32(0x205)]({'status':_0x9e2f32(0x247),'msg':'Cuota\x20eliminada\x20de\x20por\x20defecto\x20correctamente'});else return _0x21154f[_0x9e2f32(0x205)]({'status':'nothingtodo','msg':_0x9e2f32(0x21e)});}}});function a8_0x10d7(){const _0x36c422=['deleteQuota','push','execPopulate','nothingtodo','restartQuota','22376yNqiuH','findserver','118185nAcXHd','type','map','reject','quotaid','register','__awaiter','deletedquota','update','Lo\x20sentimos\x20esta\x20cuota\x20ya\x20se\x20encuentra\x20registrada','Quota','Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20del\x20servidor','30MUkhyR','express-validator','updateOne','check','length','Lo\x20sentimos\x20no\x20se\x20pudo\x20registrar\x20la\x20cuota','then','connection','Server','defineProperty','run','_id','Esta\x20cuota\x20ya\x20estÃ¡\x20establecidad\x20para\x20','deleted','custom','limit','updatedquota','withMessage','collection','json','throw','../models/Quota','create','75RlsyWK','Lo\x20sentimos\x20no\x20se\x20pudo\x20eliminar\x20la\x20cuota','validationResult','4705988McJCdZ','save','isEmpty','Source','catch','find','quota','filter','84DShomR','apply','Lo\x20sentimos\x20esta\x20cuota\x20no\x20se\x20encuentra\x20registrada','3336AdNBgy','params','next','limit_empty','type_empty','findByIdAndUpdate','self','Nada\x20que\x20hacer\x20con\x20la\x20cuota','2964980FvwcUu','findById','host','identifier','findOne','sources','servers','QuotaInterface','702ORsYHz','delete','Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20de\x20la\x20cuota','noquota','nodefault','value','getServers','notEmpty','findByIdAndDelete','getQuotas','11760419EJVCHg','isdefault','Cuota\x20establecida\x20correctamente','Lo\x20sentimos\x20no\x20se\x20pudieron\x20obtener\x20los\x20datos\x20de\x20las\x20cuotas','6525186PEaFGk','populate','body','Esta\x20cuota\x20ya\x20es\x20la\x20cuota\x20por\x20defecto'];a8_0x10d7=function(){return _0x36c422;};return a8_0x10d7();}exports['setDefault']=setDefault;const restartQuota=_0x223495=>{const _0x5f1949=a8_0x3ea6a7;Quota_1[_0x5f1949(0x1f0)]['find']({'type':_0x223495})['populate'](_0x5f1949(0x224))['then'](_0xccf190=>{const _0x747562=_0x5f1949;_0xccf190[_0x747562(0x242)]((_0x54255d,_0x18f3a4)=>{const _0x365b7e=_0x747562;_0x54255d['sources'][_0x365b7e(0x242)]((_0x29d935,_0x20c26b)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x4c79f3=_0x365b7e;yield Source_1[_0x4c79f3(0x20f)][_0x4c79f3(0x21c)]({'_id':_0x29d935[_0x4c79f3(0x1fd)]},{'quota_consumed':0x0});}));});});};exports[a8_0x3ea6a7(0x23d)]=restartQuota;